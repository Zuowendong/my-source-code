{"version":3,"file":"vue.js","sources":["../src/observer/array.js","../src/observer/index.js","../src/initState.js","../src/init.js","../src/index.js"],"sourcesContent":["/**\r\n * 重写 数组 方法\r\n * 1. 获取原来的数组方法\r\n * 2. 继承\r\n * 3. 劫持\r\n */\r\n\r\n// 1\r\nlet oldArrayPortoMethods = Array.prototype;\r\n// 2\r\nexport let ArrayMethods = Object.create(oldArrayPortoMethods);\r\n// 3\r\nlet methods = [\"push\", \"pop\", \"unshift\", \"shift\", \"splice\"];\r\n\r\nmethods.forEach((item) => {\r\n\tArrayMethods[item] = function (...args) {\r\n\t\t// console.log(\"劫持数组\", args); // {list: [1,2,3,4]}\r\n\t\tlet result = oldArrayPortoMethods[item].apply(this, args); // this -> [1,2,3,4]\r\n\r\n\t\t// 对象数组 追加 对象的情况  -> vm._data.arr.push({ name: \"lucy\" })  name: 'lucy' 未劫持\r\n\t\tlet inserted;\r\n\t\tswitch (item) {\r\n\t\t\tcase \"push\":\r\n\t\t\tcase \"unshfit\":\r\n\t\t\t\tinserted = args; // args -> 追加的 参数\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"splice\":\r\n\t\t\t\t// arr.splice(2, 0,{name: 'lucy'})  -> args -> [2,0,{name: 'lucy'}]\r\n\t\t\t\tinserted = args.splice(2); // 只取 参数 {name: 'lucy'}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\t// console.log(inserted, this);\r\n\t\tlet ob = this.__ob__;\r\n\t\tif (inserted) {\r\n\t\t\tob.observerArray(inserted); // 对追加的对象进行劫持\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t};\r\n});\r\n","import { ArrayMethods } from \"./array\";\r\n\r\nexport function observer(data) {\r\n\t// console.log(data);\r\n\tif (typeof data != \"object\" || data == null) return data;\r\n\t// 对象\r\n\treturn new Observer(data);\r\n}\r\n\r\n// vue2 对 对象 劫持 使用 Object.defineProperty  -> 缺点: 只能对 对象中一个属性 进行劫持\r\n\r\nclass Observer {\r\n\tconstructor(value) {\r\n\t\t// 给每个对象添加一个 __ob__ 属性\r\n\t\tObject.defineProperty(value, \"__ob__\", {\r\n\t\t\tenumerable: false, //不可枚举,\r\n\t\t\tvalue: this, // Observer 实例  -> 可以拿到它的observerArray方法\r\n\t\t});\r\n\r\n\t\t// 判断数据 是 对象 还是 数组类型\r\n\t\tif (Array.isArray(value)) {\r\n\t\t\t// console.log(\"数组\"); // list: [1,2,3,4]\r\n\t\t\tvalue.__proto__ = ArrayMethods;\r\n\t\t\t// 对象数组情况  -> [{ name: \"jack\" }, { name: \"tom\" }], name 未劫持\r\n\t\t\tthis.observerArray(value); // 处理 数组中对象 劫持\r\n\t\t} else {\r\n\t\t\t// 对象\r\n\t\t\tthis.walk(value); // 遍历 对 对象一层中每个属性劫持\r\n\t\t}\r\n\t}\r\n\twalk(data) {\r\n\t\t// { msg: 'Hello', info: {name: 'jack'}}\r\n\t\tlet keys = Object.keys(data);\r\n\t\tfor (let i = 0; i < keys.length; i++) {\r\n\t\t\tconst key = keys[i]; // msg\r\n\t\t\tconst value = data[key]; // Hello\r\n\t\t\tdefineReactive(data, key, value);\r\n\t\t}\r\n\t}\r\n\tobserverArray(value) {\r\n\t\tfor (let i = 0; i < value.length; i++) {\r\n\t\t\tobserver(value[i]);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// 对 对象中的属性 进行劫持\r\nfunction defineReactive(data, key, value) {\r\n\tobserver(value); // 深度代理 -> 递归处理当前属性的值 (如果还是个对象的话) -> {name: 'jack'}\r\n\tObject.defineProperty(data, key, {\r\n\t\tget() {\r\n\t\t\tconsole.log(\"获取\");\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tset(newValue) {\r\n\t\t\tconsole.log(\"设置\");\r\n\t\t\tif (newValue === value) return;\r\n\t\t\tobserver(newValue); // 处理 对象赋的 新值不响应 问题  -> vm._data.info = { name: \"tom\" } name属性不响应\r\n\t\t\tvalue = newValue;\r\n\t\t},\r\n\t});\r\n}\r\n\r\n/**\r\n * 总结 对象\r\n * 1. Object.defineProperty 有缺点: 只能对对象中一个属性进行劫持\r\n * 2. 遍历 data 中每个属性\r\n * 3. 递归 get set\r\n */\r\n\r\n/**\r\n * 数组 [1,2,3,4]  [{name: 'jack'}, {name: 'tom'}]\r\n * 函数劫持, 重写数组方法\r\n */\r\n","import { observer } from \"./observer/index\";\r\n\r\nexport function initState(vm) {\r\n\tlet opts = vm.$options;\r\n\tconsole.log(opts);\r\n\t// 各配置项初始化\r\n\tif (opts.props) {\r\n\t\tinitProps(vm);\r\n\t}\r\n\tif (opts.data) {\r\n\t\tinitData(vm);\r\n\t}\r\n\tif (opts.watch) {\r\n\t\tinitWatch(vm);\r\n\t}\r\n\tif (opts.computed) {\r\n\t\tinitComputed(vm);\r\n\t}\r\n\tif (opts.methods) {\r\n\t\tinitMethods(vm);\r\n\t}\r\n}\r\n\r\nfunction initProps() {}\r\nfunction initWatch() {}\r\nfunction initComputed() {}\r\nfunction initMethods() {}\r\n\r\n// 对 vue2 data 进行初始化\r\nfunction initData(vm) {\r\n\t// console.log(\"data初始化\", vm); // data两种类型情况 : 1.对象 2.函数(执行函数返回对象)\r\n\tlet data = vm.$options.data;\r\n\tdata = vm._data = typeof data === \"function\" ? data.call(vm) : data; // this指向问题  -> 指向vm实例\r\n\r\n\t// 对data数据进行劫持\r\n\tobserver(data);\r\n}\r\n","import { initState } from \"./initState\";\r\n\r\nexport function initMixin(Vue) {\r\n\tVue.prototype._init = function (options) {\r\n\t\t// console.log(\"vue\", options);\r\n\t\tlet vm = this; // vue实例\r\n\t\tvm.$options = options; // 挂载options方便后续使用\r\n\t\t// 初始化状态\r\n\t\tinitState(vm);\r\n\t};\r\n}\r\n","import { initMixin } from \"./init\";\r\n\r\nfunction Vue(options) {\r\n  // 初始化\r\n  this._init(options);\r\n}\r\n\r\ninitMixin(Vue);\r\n\r\nexport default Vue;\r\n"],"names":["oldArrayPortoMethods","Array","prototype","ArrayMethods","Object","create","methods","forEach","item","args","result","apply","inserted","splice","ob","__ob__","observerArray","observer","data","Observer","value","defineProperty","enumerable","isArray","__proto__","walk","keys","i","length","key","defineReactive","get","console","log","set","newValue","initState","vm","opts","$options","props","initData","watch","computed","_data","call","initMixin","Vue","_init","options"],"mappings":"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"}